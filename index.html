<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>GPT-Tico Chat</title>

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #0f172a;
    color: white;
    display: flex;
    height: 100vh;
}

.sidebar {
    width: 260px;
    background: #020617;
    padding: 15px;
    display: flex;
    flex-direction: column;
}

.sidebar h3 {
    margin: 0 0 10px;
}

.chat-list {
    flex: 1;
    overflow-y: auto;
}

.chat-item {
    padding: 10px;
    margin-bottom: 6px;
    background: #111827;
    border-radius: 6px;
    cursor: pointer;
}

.chat-item.active {
    background: #2563eb;
}

.new-chat {
    margin-top: 10px;
    padding: 10px;
    background: #22c55e;
    border-radius: 6px;
    cursor: pointer;
    text-align: center;
    color: black;
    font-weight: bold;
}

.chat-area {
    flex: 1;
    display: flex;
    flex-direction: column;
}

#chat-container {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
}

.msg-bubble {
    margin-bottom: 10px;
    padding: 10px;
    border-radius: 8px;
    max-width: 75%;
}

.user {
    background: #2563eb;
    margin-left: auto;
}

.bot {
    background: #1e293b;
}

.error {
    background: #dc2626;
}

.input-area {
    display: flex;
    padding: 10px;
    background: #020617;
}

input {
    flex: 1;
    padding: 10px;
    border-radius: 6px;
    border: none;
    outline: none;
}

button {
    margin-left: 10px;
    padding: 10px 15px;
    border: none;
    border-radius: 6px;
    background: #22c55e;
    cursor: pointer;
}
</style>
</head>

<body>

<div class="sidebar">
    <h3>Tus chats</h3>
    <div class="chat-list" id="chatList"></div>
    <div class="new-chat" id="newChatBtn">+ Nuevo chat</div>
</div>

<div class="chat-area">
    <div id="chat-container"></div>

    <div class="input-area">
        <input id="user-input" placeholder="Escribe un mensaje..." />
        <button id="send-btn">Enviar</button>
    </div>
</div>

<script>
const API_URL = "https://gpt-tico.onrender.com/api/chat";

const chatList = document.getElementById("chatList");
const chatContainer = document.getElementById("chat-container");
const sendBtn = document.getElementById("send-btn");
const userInput = document.getElementById("user-input");
const newChatBtn = document.getElementById("newChatBtn");

let chats = {};
let currentChatId = null;

/* Crear chat */
function createChat() {
    const id = "chat-" + Date.now();
    chats[id] = {
        name: "Chat " + Object.keys(chats).length,
        history: []
    };
    currentChatId = id;
    renderChatList();
    renderMessages();
}

function renderChatList() {
    chatList.innerHTML = "";
    for (let id in chats) {
        const div = document.createElement("div");
        div.className = "chat-item" + (id === currentChatId ? " active" : "");
        div.textContent = chats[id].name;
        div.onclick = () => {
            currentChatId = id;
            renderChatList();
            renderMessages();
        };
        chatList.appendChild(div);
    }
}

function renderMessages() {
    chatContainer.innerHTML = "";
    if (!currentChatId) return;

    chats[currentChatId].history.forEach(msg => {
        const div = document.createElement("div");
        div.className = "msg-bubble " + (msg.role === "user" ? "user" : "bot");
        div.innerHTML = `<b>${msg.role === "user" ? "TÃº" : "GPT-Tico"}:</b> ${msg.content}`;
        chatContainer.appendChild(div);
    });

    chatContainer.scrollTop = chatContainer.scrollHeight;
}

async function sendMessage() {
    const text = userInput.value.trim();
    if (!text || !currentChatId) return;

    chats[currentChatId].history.push({ role: "user", content: text });
    userInput.value = "";
    renderMessages();

    try {
        const response = await fetch(API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                message: text,
                history: chats[currentChatId].history
            })
        });

        const data = await response.json();

        chats[currentChatId].history.push({
            role: "assistant",
            content: data.reply
        });

        renderMessages();

    } catch {
        chats[currentChatId].history.push({
            role: "assistant",
            content: "Error al conectar con el servidor"
        });
        renderMessages();
    }
}

sendBtn.onclick = sendMessage;
userInput.onkeydown = e => {
    if (e.key === "Enter") sendMessage();
};

newChatBtn.onclick = createChat;

/* Chat inicial */
createChat();
</script>

</body>
</html>
